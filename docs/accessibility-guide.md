# アクセシビリティガイドライン

## 1. このガイドラインについて

### 1.1. 目的

このドキュメントは、本ブログプロジェクトにおけるウェブアクセシビリティの基準と実装方針を定める。目標は、障害の有無、年齢、利用環境（デバイス、ネットワーク速度など）にかかわらず、すべてのユーザーが提供される情報や機能に快適かつ平等にアクセスできるプロダクトを開発することである。

### 1.2. 対象者

このガイドラインは、開発に携わるすべてのコントリビューター、および開発を支援するAI（コード生成・レビュー時）が遵守すべき共通の指針である。アクセシビリティの向上は、プロジェクトの品質と価値を高めるための重要な要件と位置づける。

## 2. 守るべき基本原則

ウェブサイトを構築する上で基本となる考え方を以下に示す。これらの原則は、実装の判断に迷った際の拠り所となる。

- **WCAG 2.1 レベルAAへの準拠**: すべてのコンテンツは、原則として[Web Content Accessibility Guidelines (WCAG) 2.1](https://www.w3.org/TR/WCAG21/)の達成基準レベルAAを満たすことを目指す。これは、多くの公的機関で採用されている国際的な標準であり、高品質でアクセシブルな体験を提供するための実用的な基準となる。
- **セマンティクスの優先**: 可能な限りネイティブなHTML要素を使用し、正しいセマンティクスを維持する。divやspanでUIを組み立てる前に、同等の機能を持つ`<button>`, `<nav>`, `<details>`などのHTML要素がないか検討する。適切なセマンティクスは、スクリーンリーダーなどの支援技術だけでなく、検索エンジンやブラウザのリーダーモードによるコンテンツの解釈も助ける。
- **キーボード操作の保証**: マウスを使わずに、キーボードのみですべての機能が利用可能であることを保証する。これは、運動障害のあるユーザーだけでなく、キーボードショートカットを多用するパワーユーザーにとっても不可欠な要件である。
- **漸進的な機能向上 (Progressive Enhancement)**: まず基本的なHTMLでコンテンツと機能を提供し、その上にCSSでスタイリングを、JavaScriptで高度なインタラクションを追加するという考え方を取る。これにより、JavaScriptが動作しない環境でも、最低限の情報は保証される。

## 3. 具体的な実装指針

### 3.1. 意味のあるHTMLで構造を表現する

コンテンツの構造と意味を正しく伝えるため、常に最も適したHTML要素を使用する。これにより、支援技術や検索エンジンがコンテンツを正確に解釈できるようになる。

- **ランドマーク**: `<header>`, `<nav>`, `<main>`, `<aside>`, `<footer>` を適切に配置し、ページの主要な領域を明確にする。これにより、スクリーンリーダーの利用者は「メインコンテンツへジャンプする」といったショートカット機能を使え、効率的にページを読み進めることができる。
- **見出し**: `<h1>` から `<h6>` を使用してコンテンツの階層を正しく表現する。`<h1>` は各ページの主たるタイトルとし、1ページに1つだけ使用する。見出しレベルを飛ばさないこと（例: `<h2>` の次に `<h4>` を使わない）。見出しはページの「目次」として機能するため、その内容がセクションを的確に表している必要がある。
- **インタラクティブ要素**: クリックやタップでアクションを実行する要素には、原則として`<button>`要素を使用する。ページ遷移には`<a>`要素を使用する。`<div>`要素にonClickイベントを設定する実装は、キーボード操作（Enter/Spaceキーでの実行）やスクリーンリーダーの互換性で問題を生じやすいため避ける。
- **引用と図表**: 引用には `<blockquote>` を、画像やコードスニペットとそのキャプションには `<figure>` と `<figcaption>` を使用する。これにより、引用元や図表の内容が、本文と明確に区別される。

**悪い例 (Bad)**

```html
<!-- 見出しの代わりにスタイルを当てたdivを使用 -->
<div style="font-size: 24px; font-weight: bold;">ページのタイトル</div>

<!-- クリック可能なdiv。キーボードで操作できず、役割も不明 -->
<div onclick="doSomething()">アクションを実行</div>
```

**良い例 (Good)**

```html
<!-- 適切な見出しレベルを使用 -->
<h1>ページのタイトル</h1>

<!-- button要素を使用。デフォルトでキーボード操作可能 -->
<button onclick="doSomething()">アクションを実行</button>

<!-- 図とキャプション -->
<figure>
  <img src="chart.png" alt="2023年度の売上を示す棒グラフ。第4四半期に大幅な伸び。" />
  <figcaption>図1: 2023年度 売上推移</figcaption>
</figure>

<!-- 引用 -->
<blockquote>
  <p>アクセシビリティは、すべての人々のためのものである。</p>
  <footer>— <cite>ティム・バーナーズ＝リー</cite></footer>
</blockquote>
```

#### レビュー観点

- [ ] ページの主要な領域はランドマーク要素（`<main>`, `<nav>`等）で囲まれているか？
- [ ] 見出しレベルは正しく階層化されており、スキップされていないか？
- [ ] クリック可能な要素は`<button>`または`<a>`で実装されているか？

### 3.2. 画像に代替テキストを提供する

すべての`<img>`要素にalt属性を付与する。代替テキストは、画像が見えないユーザーにとって、その画像が持つ情報や文脈を伝える唯一の手段である。

- **意味を持つ画像**: 画像の内容を簡潔かつ正確に説明するテキストをaltに指定する。（例: alt="Googleのロゴ"）。グラフやチャートの場合、その画像が示唆する結論や要点を記述することが望ましい。（例: alt="Q1からQ4にかけて右肩上がりの棒グラフ。特にQ4の伸びが著しい。")
- **装飾的な画像**: コンテンツの理解に寄与しない装飾目的の画像の場合、alt=""のように空の値を設定する。alt属性自体を省略してはならない。空のaltは、支援技術に対して「この画像は意図的に無視してよい」と伝える明確なシグナルとなる。
- **テキストを含む画像**: 画像内に重要なテキストが含まれる場合、そのテキストをaltに含める。ただし、CSSで表現できるデザインでない限り、可能な限り画像内のテキストは避け、HTMLのテキストとして表現するべきである。

#### レビュー観点

- [ ] すべての`<img>`要素にalt属性が存在するか？
- [ ] 装飾的な画像にはalt=""が設定されているか？
- [ ] altの内容は、画像の文脈や機能を正確に伝えているか？

### 3.3. キーボードでの完全な操作を保証する

すべてのインタラクティブな要素は、キーボード（特にTab, Shift+Tab, Enter, Space）で操作できなければならない。

- **フォーカス可視化**: フォーカスされている要素が視覚的に明確にわかるようにする。安易にoutline: none;を指定してフォーカスインジケーターを消してはならない。デフォルトのoutlineがデザインに合わない場合は、box-shadowやbackground-colorの変更など、同等以上に目立つ代替スタイルを:focus-visible擬似クラスを用いて指定する。
- **操作順序**: Tabキーで要素間を移動する際の順序が、視覚的な順序と論理的に一致していることを確認する。DOMの構造がこの順序を決定するため、HTMLの記述順序に注意を払う。
- **カスタムコンポーネント**: `<div>`などで作成したカスタムボタンやドロップダウンメニューには、tabindex="0"を設定してフォーカス可能にし、onKeyDownイベントハンドラでEnterキーやSpaceキーに応答するように実装する。また、適切なrole属性（例: role="button"）を必ず付与する。非表示の要素やモーダルダイアログの背景コンテンツにはtabindex="-1"を設定し、フォーカス対象から除外する。

**良い例 (Good)**

```css
/* キーボードフォーカス時のみ、わかりやすいスタイルを適用。マウス操作では表示されない。 */
:focus-visible {
  outline: 2px solid blue;
  outline-offset: 2px;
  border-radius: 4px;
}
```

#### レビュー観点

- [ ] すべてのインタラクティブ要素はキーボードでフォーカス可能か？
- [ ] フォーカスされている要素は、視覚的に明確に識別できるか？
- [ ] モーダル表示時など、フォーカスが意図しない場所に移動しないか（フォーカストラップは適切か）？

### 3.4. ARIAでセマンティクスを補強する

ARIA (Accessible Rich Internet Applications) は、HTMLだけでは表現できない動的な状態や役割を伝えるために使用する。強力なツールだが、誤用はかえってアクセシビリティを損なうため、慎重に用いる必要がある。

- **第一のルール**: ARIAを使用する前に、同等のセマンティクスを持つネイティブなHTML要素で代替できないかを検討する。「ARIAの最初のルールは、ARIAを使わないこと」という言葉があるように、ネイティブ要素が持つ組み込みのキーボード操作やセマンティクスを最大限に活用する。
- **役割 (role)**: role="button"やrole="navigation"のように、要素の役割を明示する。ただし、`<button>`や`<nav>`を使えば不要。ARIAのroleは見た目ではなく、その要素が持つべき役割を上書きする。
- **プロパティと状態**: aria-label, aria-describedby, aria-hidden, aria-expanded, aria-current, aria-liveなどを適切に使用し、要素の状態やアクセシブルな名前を提供する。特に、JavaScriptで動的に変化するUIでは、これらの状態を正確に更新することが重要である。

**例: アイコンのみのボタン**

```html
<!-- テキストがないため、何のボタンか伝わらない -->
<button><svg>...</svg></button>

<!-- aria-labelでアクセシブルな名前を提供 -->
<button aria-label="設定を開く"><svg>...</svg></button>
```

**例: アコーディオンUI**

```html
<h3>
  <button aria-expanded="false" aria-controls="section1">セクション 1</button>
</h3>
<div id="section1" hidden>
  <p>セクション1のコンテンツです。</p>
</div>
<!-- JSでボタンクリック時にaria-expandedとhidden属性を切り替える -->
```

**例: 動的な通知（トーストなど）**

```html
<!-- role="alert"は暗黙的にaria-live="assertive"を持つ。画面に表示されると即座に読み上げられる。 -->
<div role="alert">記事へのリンクをコピーしました。</div>

<!-- 検索結果件数など、緊急性の低い更新にはaria-live="polite"を使用する -->
<div aria-live="polite"><span>3</span>件の記事が見つかりました。</div>
```

#### レビュー観点

- [ ] ARIAを使用する前に、ネイティブHTML要素で代替できないか検討したか？
- [ ] インタラクティブなカスタムコンポーネントには適切なroleとaria-\*属性が付与されているか？
- [ ] UIの状態変化（開閉、表示/非表示など）に応じて、ARIA属性はJavaScriptで正しく更新されているか？

### **3.5. アクセシブルなフォームを設計する**

本ブログでは検索機能が提供されている。すべてのユーザーが情報を正確に入力できるよう、特に注意深く設計する必要がある。

- **ラベル付け**: すべてのフォームコントロール（`<input>`, `<textarea>`, `<select>`）には、`<label>`を関連付ける。for属性とid属性を一致させる方法が最も確実である。これにより、ラベルをクリックした際に入力欄にフォーカスが移動し、スクリーンリーダーも入力欄の目的を正しく読み上げられる。
- **プレースホルダー非依存**: placeholder属性はラベルの代わりにはならない。入力開始と同時に消えてしまうため、ユーザーが何を入力すべきか忘れてしまう原因になる。あくまで入力例を示す補助的なものとして使用する。
- **エラー通知**: バリデーションエラーが発生した場合、その内容をテキストで明確に伝え、エラーが発生した入力フィールドにaria-invalid="true"を設定する。さらにaria-describedbyを用いてエラーメッセージをプログラム的に関連付けることで、スクリーンリーダーがエラー内容を読み上げられるようにする。

**良い例: 検索フォーム**

```html
<form action="/search" method="get" role="search">
  <label for="search-input">サイト内検索</label>
  <input id="search-input" type="search" name="q" placeholder="キーワードを入力..." aria-describedby="search-error" />
  <button type="submit">検索</button>
  <div id="search-error" class="error-message" role="alert"><!-- エラー時にメッセージを表示 --></div>
</form>
```

#### レビュー観点

- [ ] すべてのフォーム要素に`<label>`が関連付けられているか？
- [ ] エラーメッセージは視覚的に表示され、かつaria-describedbyで入力欄と関連付けられているか？
- [ ] エラー発生時、aria-invalid="true"が設定されているか？

### 3.6. 視覚的な分かりやすさを担保する

色やコントラストは、視覚的に情報を伝える上で重要な要素だが、すべてのユーザーが同じように色を認識するわけではないことを考慮する。

- **コントラスト比**: テキストとその背景色のコントラスト比は、WCAGレベルAAの基準（通常のテキストで**4.5:1**、大きなテキストで**3:1**）を満たす必要がある。これは、ロービジョン（弱視）のユーザーや、明るい屋外で画面を見るユーザーにとって読みやすさを保証する上で極めて重要である。各種コントラストチェックツールで確認する。
- **色以外の手段**: リンクの下線、エラーを示すアイコンや太字のように、色だけを情報伝達の唯一の手段としない。色覚特性を持つユーザーは、色の違いを識別できない可能性があるため、形やテキスト、アイコンなど、他の視覚的な手がかりを併用する。

#### レビュー観点

- [ ] テキストと背景のコントラスト比は4.5:1以上（大きな文字は3:1以上）あるか？
- [ ] 状態（エラー、選択中など）を色だけで伝えていないか？

### 3.7. コンテンツ作成時に注意する

アクセシビリティは、エンジニアだけでなくコンテンツ作成者も意識する必要がある。

- **リンクのテキスト**: 記事本文中のリンクは、「この記事」「こちら」のような曖昧な表現ではなく、リンク先の内容が推測できる具体的なテキストにする。スクリーンリーダーの利用者は、ページ内のリンクを一覧表示して拾い読みすることがある。その際、「詳細はこちら」というリンクが並んでも、どこへ遷移するのか全くわからない。
  - **悪い例**: 詳細については、[こちら](http://docs.google.com/page.html)をクリックしてください。
  - **良い例**: 詳細については、[アクセシビリティガイドライン](http://docs.google.com/page.html)をお読みください。
  - **良い例（外部リンク）**: 詳細は[W3C公式サイト](http://docs.google.com/page.html)をご覧ください（新規タブで開きます）。
- **コードブロック**: `<pre>` と `<code>` 要素を正しく使用する。シンタックスハイライトを適用する際は、テキストと背景のコントラスト比が十分に確保されていることを確認する。また、コードをコピーするためのボタンを設置する場合は、そのボタンがキーボードで操作可能で、かつ「〜のコードをコピー」のように明確なラベルを持つ必要がある。
- **注釈とアラート**: 記事内で注意を促すためのボックス（「Note」「Warning」など）には、role="note" や role="status" などを適切に設定する。さらに、アイコンだけでなく「補足：」「警告：」といったテキストラベルも併記することで、そのボックスの意図をすべてのユーザーに明確に伝える。

#### レビュー観点

- [ ] リンクテキストは、リンク先の文脈を説明しているか？
- [ ] コードブロックのシンタックスハイライトは十分なコントラストを保っているか？
- [ ] 注釈ボックスは、その役割が視覚的にもプログラム的にも伝わるようになっているか？

## 4. 参考資料

- [Web Content Accessibility Guidelines (WCAG) 2.1](https://www.w3.org/TR/WCAG21/)
- [MDN Web Docs - Accessibility](https://developer.mozilla.org/ja/docs/Web/Accessibility)
- [総務省 - みんなの公共サイト運用ガイドライン](https://www.soumu.go.jp/main_sosiki/joho_tsusin/b_free/guideline.html)
- [ARIA Authoring Practices Guide (APG)](https://www.w3.org/WAI/ARIA/apg/)
